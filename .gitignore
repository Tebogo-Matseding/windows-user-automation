param (
    [string]$CsvPath = ".\users.csv"
)

# Check if CSV exists
if (-Not (Test-Path $CsvPath)) {
    Write-Error "CSV file not found at $CsvPath"
    exit
}

# Import users from CSV
$users = Import-Csv -Path $CsvPath

foreach ($user in $users) {
    $username = $user.Username
    $password = $user.Password | ConvertTo-SecureString -AsPlainText -Force

    try {
        # Create local user
        New-LocalUser -Name $username -Password $password -FullName $username -Description "Created via automation script"
        Write-Output "User $username created successfully."
    }
    catch {
        Write-Warning "Could not create user $username. Error: $_"
    }
}
